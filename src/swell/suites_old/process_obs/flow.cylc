#!jinja2

# (C) Copyright 2021-2022 United States Government as represented by the Administrator of the
# National Aeronautics and Space Administration. All Rights Reserved.
#
# This software is licensed under the terms of the Apache Licence Version 2.0
# which can be obtained at http://www.apache.org/licenses/LICENSE-2.0.

# --------------------------------------------------------------------------------------------------

# Cylc suite for executing a workflow that retrieves backgrounds from a GEOS experiment and
# stores them in R2D2

# --------------------------------------------------------------------------------------------------

%include "suite.jinja2"

# --------------------------------------------------------------------------------------------------

[scheduler]
    UTC mode = True

# --------------------------------------------------------------------------------------------------

[scheduling]

    initial cycle point = {{suite_properties["intial cylc point"]}}
    final cycle point = {{suite_properties["final cylc point"]}}
    runahead limit = {{suite_properties["runahead limit"]}}

    [[graph]]
        T00,T06,T12,T18 = """
                          ObsProcessSetup
                          #GetBackgroundGeosExperiment => StoreBackground #=> CleanCycle
                          """

# --------------------------------------------------------------------------------------------------

[runtime]

    # Task defaults
    # -------------
    [[root]]
        pre-script = "source $CYLC_SUITE_DEF_PATH/modules"

        [[[environment]]]
            config   = $CYLC_SUITE_DEF_PATH/experiment-filled.yaml
            datetime = $CYLC_TASK_CYCLE_POINT

    # Tasks
    # -----
    [[ObsProcessSetup]]
        script = "swell_task ObsProcessSetup $config -d $datetime"

    #[[StoreBackground]]
    #    script = "swell_task StoreBackground $config -d $datetime"

    #[[CleanCycle]]
    #    script = "swell_task CleanCycle $config -d $datetime"

# --------------------------------------------------------------------------------------------------
