obs operator:
  name: VertInterp
obs space:
  name: satwind
  obsdatain:
    engine:
      type: H5File
      obsfile: '{{cycle_dir}}/satwind.{{window_begin}}.nc4'
  obsdataout:
    engine:
      type: H5File
      obsfile: '{{cycle_dir}}/{{experiment_id}}.satwind.{{window_begin}}.nc4'
  simulated variables: [eastward_wind, northward_wind]
obs filters:
#
- filter: PreQC
  maxvalue: 3
  action:
    name: reject
#
- filter: Perform Action
  filter variables:
  - name: eastward_wind
  where:
  - variable: PreUseFlag/eastward_wind
    is_in: 100
  action:
    name: reject
#
- filter: Perform Action
  filter variables:
  - name: northward_wind
  where:
  - variable: PreUseFlag/northward_wind
    is_in: 100
  action:
    name: reject
#
- filter: Perform Action
  filter variables:
  - name: eastward_wind
  - name: northward_wind
  action:
    name: assign error
    error function:
      name: ObsErrorModelStepwiseLinear@ObsFunction
      options:
        xvar:
          name: air_pressure@MetaData
        xvals: [100000, 95000, 80000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000]   #Pressure (Pa)
        errors: [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2]
#
- filter: BlackList
  where:
  - variable:
      name: eastward_wind@ObsType
    is_in: 240, 241, 248, 249, 251, 255, 256, 260
#
- filter: Perform Action
  filter variables:
  - name: eastward_wind
  - name: northward_wind
  action:
    name: assign error
    error function:
      name: ObsErrorModelStepwiseLinear@ObsFunction
      options:
        xvar:
          name: air_pressure@MetaData
        xvals: [100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000]   #Pressure (Pa)
        errors: [5.9, 5.9, 5.9, 5.9, 5.45, 5, 5, 5, 5.075, 5.175, 5.3, 5.675, 6.05, 6.25, 6.625, 7, 7, 7, 7]
  where:
  - variable:
      name: eastward_wind@ObsType
    is_in: 244
#
- filter: Perform Action
  filter variables:
  - name: eastward_wind
  - name: northward_wind
  action:
    name: assign error
    error function:
      name: ObsErrorModelStepwiseLinear@ObsFunction
      options:
        xvar:
          name: air_pressure@MetaData
        xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]   #Pressure (Pa)
        errors: [1.9, 1.9, 1.9, 1.9, 1.9, 1.9, 1.9, 1.9, 1.95, 1.95, 2, 2, 2.05, 2.5, 3, 3.15, 3.3, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5, 3.5]
         errors: [3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.9, 3.9, 4.0, 4.0, 4.1, 5, 6, 6.3, 6.6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7]
  where:
  - variable:
      name: eastward_wind@ObsType
    is_in: 245, 246
#
- filter: Perform Action
  filter variables:
  - name: eastward_wind
  - name: northward_wind
  action:
    name: assign error
    error function:
      name: ObsErrorModelStepwiseLinear@ObsFunction
      options:
        xvar:
          name: air_pressure@MetaData
        xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]   #Pressure (Pa)
        errors: [3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.9, 3.9, 4.0, 4.0, 4.1, 5, 6, 6.3, 6.6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7]
  where:
  - variable:
      name: eastward_wind@ObsType
    is_in: 242, 243, 247, 252, 253
#
- filter: Perform Action
  filter variables:
  - name: eastward_wind
  - name: northward_wind
  action:
    name: assign error
    error function:
      name: ObsErrorModelStepwiseLinear@ObsFunction
      options:
        xvar:
          name: air_pressure@MetaData
        xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]   #Pressure (Pa)
        errors: [3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.9, 3.9, 4.0, 4.5, 6.1, 6.0, 6.5, 7.3, 7.6, 7, 7.5, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7]
  where:
  - variable:
      name: eastward_wind@ObsType
    is_in: 254
#
- filter: Perform Action
  filter variables:
  - name: eastward_wind
  - name: northward_wind
  action:
    name: assign error
    error function:
      name: ObsErrorModelStepwiseLinear@ObsFunction
      options:
        xvar:
          name: air_pressure@MetaData
        xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]   #Pressure (Pa)
        errors: [3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.8, 3.9, 3.9, 4.0, 4.0, 4.1, 5.0, 7, 7.3, 7.6, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8]
  where:
  - variable:
      name: eastward_wind@ObsType
    is_in: 250
#
- filter: Perform Action
  filter variables:
  - name: eastward_wind
  - name: northward_wind
  action:
    name: assign error
    error function:
      name: ObsErrorModelStepwiseLinear@ObsFunction
      options:
        xvar:
          name: air_pressure@MetaData
        xvals: [100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000]   #Pressure (Pa)
        errors: [5.9, 5.9, 5.9, 5.9, 5.9, 5.9, 5.9, 5.9, 5.675, 5.45, 5.525, 5.8, 6.275, 6.575, 6.825, 7.05, 7.05, 7.05, 7.05]
  where:
  - variable:
      name: eastward_wind@ObsType
    is_in: 257
#
- filter: Perform Action
  filter variables:
  - name: eastward_wind
  - name: northward_wind
  action:
    name: assign error
    error function:
      name: ObsErrorModelStepwiseLinear@ObsFunction
      options:
        xvar:
          name: air_pressure@MetaData
        xvals: [60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000]   #Pressure (Pa)
        errors: [6.05, 5.625, 5.275, 5.375, 5.925, 6.475, 6.775, 7.05, 7.05, 7.05, 7.05]
  where:
  - variable:
      name: eastward_wind@ObsType
    is_in: 258
#
- filter: Perform Action
  filter variables:
  - name: eastward_wind
  - name: northward_wind
  action:
    name: assign error
    error function:
      name: ObsErrorModelStepwiseLinear@ObsFunction
      options:
        xvar:
          name: air_pressure@MetaData
        xvals: [100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000]   #Pressure (Pa)
        errors: [6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6, 5.5, 5.5, 5.575, 6.025, 6.4, 6.775, 7.15, 7.15, 7.15, 7.15]
  where:
  - variable:
      name: eastward_wind@ObsType
    is_in: 259
#
- filter: Difference Check
  filter variables:
  - name: eastward_wind
  - name: northward_wind
  reference: surface_pressure@GeoVaLs
  value: air_pressure@MetaData
  maxvalue: -11000
  where:
  - variable:
      name: eastward_wind@ObsType
    is_in: 247
  - variable:
      name: surface_type@MetaData
    minvalue: 0.01
#
- filter: Difference Check
  filter variables:
  - name: eastward_wind
  - name: northward_wind
  reference: surface_pressure@GeoVaLs
  value: air_pressure@MetaData
  maxvalue: -20000
  where:
  - variable:
      name: eastward_wind@ObsType
    is_in: 244, 257, 258, 259, 260
  - variable:
      name: surface_type@MetaData
    minvalue: 0.01
#
- filter: Bounds Check
  filter variables:
  - name: eastward_wind
  - name: northward_wind
  test variables:
  - name: WindDirAngleDiff@ObsFunction
  maxvalue: 50.0
  where:
  - variable:
      name: eastward_wind@ObsType
    is_in: 247
  action:
    name: reject
#
- filter: Bounds Check
  filter variables:
  - name: eastward_wind
  - name: northward_wind
  test variables:
  - name: SatWindsLNVDCheck@ObsFunction
  maxvalue: 3
  where:
  - variable:
      name: eastward_wind@ObsType
    is_in: 244, 247, 257-260
  action:
    name: reject
#
- filter: BlackList
  filter variables:
  - name: eastward_wind
  where:
    - variable:
        name: ObsType/eastward_wind
      is_in: 240-260
  action:
    name: inflate error
    inflation variable:
      name: ObsErrorFactorPressureCheck@ObsFunction
      options:
        variable: eastward_wind
        z_height: false
#
- filter: BlackList
  filter variables:
  - name: northward_wind
  where:
    - variable:
        name: ObsType/eastward_wind
      is_in: 240-260
  action:
    name: inflate error
    inflation variable:
      name: ObsErrorFactorPressureCheck@ObsFunction
      options:
        variable: northward_wind
        z_height: false
#
- filter: Background Check
  filter variables:
  - name: eastward_wind
  function absolute threshold:
  - name: SatWindsSPDBCheck@ObsFunction
    options:
      satwndtype: [  240,  241,  242,  243,  244,  245,  246,  247,  248,  249,
                     250,  251,  252,  253,  254,  256,  257,  258,  259,  260]
      error_min: [  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,
                    1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4]
      error_max: [  6.1,  6.1, 15.0, 15.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0,
                   20.0, 20.0, 20.0, 20.0, 20.0, 20.1, 20.1, 20.1, 20.1, 20.1]
      cgross:    [  2.5,  2.5,  2.5,  1.5,  2.5,  1.3,  1.3,  2.5,  2.5,  2.5,
                    2.5,  1.3,  2.5,  1.5,  1.5,  2.5,  2.5,  2.5,  2.5,  2.5]
      windtype:  [  240,  241,  242,  243,  244,  245,  246,  247,  248,  249,
                    250,  251,  252,  253,  254,  256,  257,  258,  259,  260]
      variable: eastward_wind
  action:
    name: reject
  #defer to post: true
#
- filter: Background Check
  filter variables:
  - name: northward_wind
  function absolute threshold:
  - name: SatWindsSPDBCheck@ObsFunction
    options:
      satwndtype: [  240,  241,  242,  243,  244,  245,  246,  247,  248,  249,
                     250,  251,  252,  253,  254,  256,  257,  258,  259,  260]
      cgross:     [  2.5,  2.5,  2.5,  1.5,  2.5,  1.3,  1.3,  2.5,  2.5,  2.5,
                     2.5,  1.3,  2.5,  1.5,  1.5,  2.5,  2.5,  2.5,  2.5,  2.5]
      error_min:  [  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,
                     1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4,  1.4]
      error_max:  [  6.1,  6.1, 15.0, 15.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0,
                    20.0, 20.0, 20.0, 20.0, 20.0, 20.1, 20.1, 20.1, 20.1, 20.1]
      variable: northward_wind
  action:
    name: reject
  #defer to post: true
#
- filter: BlackList
  filter variables:
  - name: eastward_wind
  - name: northward_wind
  action:
    name: inflate error
    inflation variable:
      name: ObsErrorFactorDuplicateCheck@ObsFunction
  where:
  - variable:
      name: eastward_wind@ObsType
    is_in:  240-260
  defer to post: true
