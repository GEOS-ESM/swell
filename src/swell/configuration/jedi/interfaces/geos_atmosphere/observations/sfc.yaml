obs operator:
  name: SfcPCorrected
  observation alias file: {{experiment_root}}/{{experiment_id}}/configuration/jedi/interfaces/{{model_component}}/observations/obsop_name_map.yaml
  da_psfc_scheme: UKMO
# geovar_geomz: geopotential_height
# geovar_sfc_geomz: surface_geopotential_height
obs space:
  name: sfc
  obsdatain:
    engine:
      type: H5File
      obsfile: '{{cycle_dir}}/sfc.{{window_begin}}.nc4'
  obsdataout:
    engine:
      type: H5File
      obsfile: '{{cycle_dir}}/{{experiment_id}}.sfc.{{window_begin}}.nc4'
  simulated variables: [stationPressure] #, airTemperature]
obs filters:
# Observation Range Sanity Check
- filter: Bounds Check
  filter variables:
  - name: stationPressure
  minvalue: 37499
  maxvalue: 106999
  action:
    name: reject
# Reject all obs with PreQC mark already set above 3
- filter: PreQC
  maxvalue: 3
  action:
    name: reject
# Assign obsError.
- filter: BlackList
  filter variables:
  - name: stationPressure
  action:
    name: assign error
    error parameter: 120             # 120 Pa (1.2mb)
#
- filter: BlackList
  filter variables:
  - name: stationPressure
  action:
    name: assign error
    error function:
      name: ObsFunction/ObsErrorModelStepwiseLinear
      options:
        xvar:
          name: ObsValue/stationPressure
        xvals: [80000, 75000]
        errors: [110, 120]
  where:
  - variable:
      name: ObsType/stationPressure
    is_in: 181          # Type is SYNOP
#
- filter: BlackList
  filter variables:
  - name: stationPressure
  action:
    name: assign error
    error function:
      name: ObsFunction/ObsErrorModelStepwiseLinear
      options:
        xvar:
          name: ObsValue/stationPressure
        xvals: [85000, 80000]
        errors: [120, 140]
  where:
  - variable:
      name: ObsType/stationPressure
    is_in: 187          # Type is METAR
#
# Inflate ObsError as it is done with GSI
- filter: BlackList
  filter variables:
  - name: stationPressure
  action:
    name: inflate error
    inflation variable:
      name: ObsFunction/ObsErrorFactorSfcPressure
      options:
#       original_obserr: ObsError
        error_min: 100         # 1 mb
        error_max: 300         # 3 mb
        geovar_sfc_geomz: surface_geopotential_height
#
# If the ObsError is inflated too much, reject the obs
- filter: Bounds Check
  filter variables:
  - name: stationPressure
  action:
    name: reject
  maxvalue: 3.6
  test variables:
  - name: ObsFunction/ObsErrorFactorQuotient
    options:
      numerator:
        name: ObsErrorData/stationPressure   # After inflation step
      denominator:
        name: ObsError/stationPressure
  defer to post: true
  where:
  - variable:
      name: ObsType/stationPressure
    is_in: 181          # Type is SYNOP
#
- filter: Bounds Check
  filter variables:
  - name: stationPressure
  action:
    name: reject
  maxvalue: 4.0
  test variables:
  - name: ObsFunction/ObsErrorFactorQuotient
    options:
      numerator:
        name: ObsErrorData/stationPressure   # After inflation step
      denominator:
        name: ObsError/stationPressure
  defer to post: true
  where:
  - variable:
      name: ObsType/stationPressure
    is_in: 187          # Type is METAR
